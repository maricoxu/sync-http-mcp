# Sync-HTTP-MCP 使用指南

本文档提供了Sync-HTTP-MCP服务的详细使用说明，帮助您快速设置和使用这个百度内网远程开发工具。

## 1. 系统概述

Sync-HTTP-MCP采用直接部署模式，将HTTP服务器部署在百度内网服务器上，本地通过端口转发与之通信。这种模式简化了架构，消除了中间层，提高了系统性能和可靠性。

### 工作原理

```
本地电脑 ────────────────────────────────► 百度跳板机 ─────────────────► 内网服务器
   │                                         │
   │                                         │
   ▼                                         ▼
本地端口 ◄──────────── SSH隧道 ───────────► 远程HTTP服务
  8081                                      8081
   │
   │
   ▼
Cursor IDE
```

## 2. 安装步骤

### 2.1 服务器端设置

1. **登录内网服务器**
   ```bash
   relay-cli
   ssh [hostname_or_ip]
   ```

2. **下载项目代码**
   ```bash
   git clone [项目仓库URL] ~/sync-http-mcp
   cd ~/sync-http-mcp
   ```

3. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

4. **启动服务器**
   ```bash
   python src/remote_server.py --port 8081 --host 127.0.0.1
   ```

   或使用nohup让服务在后台运行:
   ```bash
   nohup python src/remote_server.py --port 8081 --host 127.0.0.1 > server.log 2>&1 &
   ```

### 2.2 本地端口转发设置

1. **自动设置**
   
   使用提供的脚本一键设置:
   ```bash
   ~/Code/sync-http-mcp/scripts/setup-tunnel.sh [hostname_or_ip] 8081
   ```

2. **手动设置**
   
   如果需要手动设置，请执行:
   ```bash
   # 打开新终端窗口
   relay-cli
   # 连接成功后
   ssh -N -L 8081:localhost:8081 [hostname_or_ip]
   ```

### 2.3 Cursor插件设置

> 注: Cursor插件尚在开发中，以下为未来设置步骤

1. **安装插件**
   - 打开Cursor IDE
   - 进入插件管理器
   - 搜索"Sync-HTTP-MCP"并安装

2. **配置插件**
   - 打开插件设置
   - 设置服务器URL: `http://localhost:8081`
   - 设置本地项目路径
   - 设置远程项目路径

## 3. 日常使用

### 3.1 开始新的工作会话

1. **确保服务器正在运行**
   - 如果需要，登录服务器并启动HTTP服务

2. **设置端口转发**
   - 运行 `~/Code/sync-http-mcp/scripts/setup-tunnel.sh`
   - 保持转发窗口打开

3. **打开Cursor并开始工作**
   - 所有文件修改将自动同步到远程服务器

### 3.2 文件操作

所有文件操作都将自动同步。如果需要手动触发同步:

- 右键点击文件或目录，选择"同步到服务器"
- 使用快捷键 `Ctrl+Shift+S` (或macOS上的 `Cmd+Shift+S`)

### 3.3 远程命令执行

1. **构建项目**
   - 点击Cursor插件面板中的"构建"按钮
   - 或使用快捷键 `Ctrl+Shift+B` (或macOS上的 `Cmd+Shift+B`)

2. **自定义命令**
   - 在插件设置中配置常用命令
   - 在命令面板中选择并执行

3. **查看输出**
   - 构建和命令输出将显示在输出面板中
   - 错误将自动高亮并链接到相应的文件位置

## 4. 高级功能

### 4.1 差量同步

系统使用差量同步算法，只传输变更的部分:

- 对于文本文件，仅传输变更的行
- 对于二进制文件，使用块差异算法

### 4.2 文件排除

配置不需要同步的文件类型或目录:

```json
{
  "exclude": [
    "*.o",
    "*.pyc",
    "node_modules",
    "build",
    ".git"
  ]
}
```

### 4.3 远程终端访问

通过插件面板，可以打开一个集成终端，直接连接到远程服务器:

1. 点击"远程终端"按钮
2. 终端将自动通过HTTP服务与内网服务器建立连接
3. 执行shell命令，就像在服务器上一样

## 5. 故障排除

### 5.1 连接问题

如果无法连接到服务器:

1. **检查端口转发**
   ```bash
   lsof -i:8081
   ```
   确认有SSH进程在监听该端口

2. **检查服务器状态**
   ```bash
   curl http://localhost:8081
   ```
   应该返回服务器信息

3. **重新建立隧道**
   ```bash
   # 先关闭现有隧道
   kill $(lsof -t -i:8081)
   # 重新建立
   ~/Code/sync-http-mcp/scripts/setup-tunnel.sh
   ```

### 5.2 同步问题

如果文件同步失败:

1. **检查路径映射**
   确保本地和远程路径配置正确

2. **手动触发同步**
   使用插件菜单中的"强制同步"选项

3. **检查日志**
   查看插件日志和服务器日志中的错误信息

### 5.3 恢复丢失的更改

如果发生冲突或意外覆盖:

1. 插件维护本地文件的版本历史
2. 右键点击文件，选择"查看历史版本"
3. 比较并恢复需要的版本

## 6. 最佳实践

1. **始终保持端口转发连接**
   - 设置自动重连
   - 使用终端多路复用器(如tmux)保持会话

2. **定期备份**
   - 使用Git管理关键代码
   - 定期提交和推送更改

3. **优化工作流程**
   - 将常用命令添加到插件配置中
   - 使用快捷键提高效率

## 7. 相关资源

- [项目GitHub仓库](https://github.com/yourusername/sync-http-mcp)
- [API文档](./api_reference.md)
- [常见问题解答](./faq.md)
- [参与贡献](../CONTRIBUTING.md)